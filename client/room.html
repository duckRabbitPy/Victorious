<!DOCTYPE html>
<html>
  <head>
    <title>Dominion</title>
  </head>
  <body>
    <div id="app"></div>
    <h1>Room <span id="room-number"></span></h1>
    <div style="display: flex; flex-direction: column; align-items: center">
      <button id="init" onclick="init()">Start</button>
      <button id="next" onclick="next()">Next</button>
      <div id="game-state">
        <h2>Game state</h2>
        <pre id="game-state-text"></pre>
      </div>
    </div>
    <script>
      setRoomNumber();

      const socket = new WebSocket("ws://localhost:8080");

      socket.addEventListener("open", (event) => {
        console.log("WebSocket connection opened:", event);
      });

      socket.addEventListener("message", (event) => {
        console.log("Received message:", event.data);
        displayMessage(event.data);
      });

      socket.addEventListener("close", (event) => {
        console.log("WebSocket connection closed:", event);
      });

      function setRoomNumber() {
        document.getElementById("room-number").innerText =
          window.location.pathname.split("/")[2];
      }

      function init() {
        socket.send(
          JSON.stringify({
            effect: "init",
            room: window.location.pathname.split("/")[2],
          })
        );
      }

      function next() {
        socket.send(
          JSON.stringify({
            effect: "next",
            room: window.location.pathname.split("/")[2],
          })
        );
      }

      function displayMessage(message) {
        const data = JSON.parse(message);
        document.getElementById("game-state-text").innerText = JSON.stringify(
          data,
          null,
          2
        );
      }
    </script>
  </body>
</html>
